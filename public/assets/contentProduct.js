chrome.runtime.onMessage.addListener((s,l,c)=>{if(s.action==="scrape_product")try{const i=g();c({success:!0,data:i})}catch(i){console.error("Scraping error:",i),c({success:!1,error:i.message})}});function g(){const s=document.querySelector("h1.CEn5rD")?.innerText||document.querySelector("h1.yhB1nd")?.innerText||document.title,l=document.querySelector("div.hZ3P6w")?.innerText||document.querySelector("div._30jeq3")?.innerText||"",c=document.querySelector("div.kRYCnD")?.innerText||document.querySelector("div._3I9_wc")?.innerText||"",i=document.querySelector("div.HQe8jr")?.innerText||document.querySelector("div._3Ay6Sb")?.innerText||"",a=document.querySelector("div.MKiFS6")?.innerText||document.querySelector("div._3LWZlK")?.innerText||"",m=document.querySelector("span.PvbNMB")?.innerText||document.querySelector("span._2_R_DZ")?.innerText||"",h=document.querySelector("#sellerName span span")?.innerText||document.querySelector("div._1RLviY")?.innerText||"";let o=document.querySelector("div.cdXR5N")?.innerText||document.querySelector("div._1mXcCf")?.innerText||document.querySelector("div.R0cy0y")?.innerText||document.querySelector("div.tUTk_J div:nth-child(2)")?.innerText||"";if(!o){const e=Array.from(document.querySelectorAll("div")).find(t=>t.innerText.trim()==="Description"&&t.className.length>5);e&&e.nextElementSibling&&(o=e.nextElementSibling.innerText)}let u=[];const S=["div.jwbTM1 ul li","div._2cM9lP ul li","li._21lJbe","div._2418kt ul li"],y=document.querySelectorAll(S.join(", "));if(y.length>0)y.forEach(r=>u.push(r.innerText));else{const e=Array.from(document.querySelectorAll("div")).find(t=>t.innerText==="Highlights"&&t.classList.length>0);if(e){const t=e.closest("div.row")||e.closest("div._3k-BhJ");t&&t.querySelectorAll("ul li").forEach(f=>u.push(f.innerText))}}const n={};l&&(n.Price=l),c&&(n.MRP=c),i&&(n.Discount=i),o&&(n.Description=o),h&&(n.Seller=h),a&&(n.Rating=a),m&&(n.Reviews=m),document.querySelectorAll("tr.v1Jif8, tr._1s_Smc").forEach(r=>{const e=r.querySelector("td:first-child")?.innerText,t=r.querySelector("td:nth-child(2)")?.innerText;e&&t&&(n[e]=t)});const d=new Set;return document.querySelectorAll("ul.f67RGv img, ul._3GnUWp img, ul.q6DClP img").forEach(r=>{let e=r.src||r.getAttribute("src");if(e){const t=e.replace(/\/image\/\d+\/\d+\//,"/image/1280/1280/");d.add(t)}}),document.querySelectorAll("img.UCc1lI, img._396cs4, img._2r_T1I").forEach(r=>{let e=r.src;e&&d.add(e.replace(/\/image\/\d+\/\d+\//,"/image/1280/1280/"))}),{title:s,price:l,description:o,specifications:n,highlights:u,images:Array.from(d),url:window.location.href}}
