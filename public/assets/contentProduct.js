chrome.runtime.onMessage.addListener((s,u,o)=>{if(s.action==="scrape_product")try{const i=x();o({success:!0,data:i})}catch(i){console.error("Scraping error:",i),o({success:!1,error:i.message})}});function x(){const s=document.querySelector("h1.CEn5rD")?.innerText||document.querySelector("h1.yhB1nd")?.innerText||document.title,u=document.querySelector("div.hZ3P6w")?.innerText||document.querySelector("div._30jeq3")?.innerText||"",o=document.querySelector("div.kRYCnD")?.innerText||document.querySelector("div._3I9_wc")?.innerText||"",i=document.querySelector("div.HQe8jr")?.innerText||document.querySelector("div._3Ay6Sb")?.innerText||"",a=document.querySelector("div.MKiFS6")?.innerText||document.querySelector("div._3LWZlK")?.innerText||"",m=document.querySelector("span.PvbNMB")?.innerText||document.querySelector("span._2_R_DZ")?.innerText||"",f=document.querySelector("#sellerName span span")?.innerText||document.querySelector("div._1RLviY")?.innerText||"";let l=document.querySelector("div.cdXR5N")?.innerText||document.querySelector("div._1mXcCf")?.innerText||document.querySelector("div.R0cy0y")?.innerText||document.querySelector("div.tUTk_J div:nth-child(2)")?.innerText||"";if(!l){const e=Array.from(document.querySelectorAll("div")).find(r=>r.innerText.trim()==="Description"&&r.className.length>5);e&&e.nextElementSibling&&(l=e.nextElementSibling.innerText)}let c=[];const g=["div.key-features-content ul li","div._2cM9lP ul li","div.x-v-m ul li","li._21lJbe","div._2418kt ul li"];if(document.querySelectorAll(g.join(", ")).forEach(t=>{const e=t.innerText.trim();e&&c.push(e)}),c.length===0){const t=Array.from(document.querySelectorAll("*")).filter(e=>e.children.length===0&&e.innerText.trim()==="Highlights"&&e.tagName!=="SCRIPT"&&e.tagName!=="STYLE");for(const e of t){let r=e.parentElement,S=!1;for(let y=0;y<5&&r;y++){const h=r.querySelector("ul");if(h&&(h.querySelectorAll("li").forEach(q=>c.push(q.innerText.trim())),c.length>0)){S=!0;break}r=r.parentElement}if(S)break}}c=[...new Set(c)];const n={};u&&(n.Price=u),o&&(n.MRP=o),i&&(n.Discount=i),l&&(n.Description=l),f&&(n.Seller=f),a&&(n.Rating=a),m&&(n.Reviews=m),document.querySelectorAll("tr.v1Jif8, tr._1s_Smc").forEach(t=>{const e=t.querySelector("td:first-child")?.innerText,r=t.querySelector("td:nth-child(2)")?.innerText;e&&r&&(n[e]=r)});const d=new Set;return document.querySelectorAll("ul.f67RGv img, ul._3GnUWp img, ul.q6DClP img").forEach(t=>{let e=t.src||t.getAttribute("src");if(e){const r=e.replace(/\/image\/\d+\/\d+\//,"/image/1280/1280/");d.add(r)}}),document.querySelectorAll("img.UCc1lI, img._396cs4, img._2r_T1I").forEach(t=>{let e=t.src;e&&d.add(e.replace(/\/image\/\d+\/\d+\//,"/image/1280/1280/"))}),{title:s,price:u,description:l,specifications:n,highlights:c,images:Array.from(d),url:window.location.href}}
