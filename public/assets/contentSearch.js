let o=!1;chrome.runtime.onMessage.addListener((e,n,t)=>{e.action==="start_search_scraping"?(o=!0,r(),t({status:"started"})):e.action==="stop_search_scraping"&&(o=!1,t({status:"stopped"}))});async function r(){let e=[];for(;o;){const n=l();if(n.length===0){console.log("No links found, stopping.");break}e=[...e,...n],chrome.storage.local.set({scannedProducts:e}),chrome.runtime.sendMessage({action:"update_count",count:e.length});const t=c();if(t)t.click(),await new Promise(s=>setTimeout(s,3e3));else{console.log("No next button, finishing.");break}}chrome.runtime.sendMessage({action:"scraping_finished",total:e.length}),o=!1}function l(){const e=document.querySelectorAll("a.GnxRXv"),n=[];return e.forEach(t=>{n.push({url:t.href,title:t.querySelector("img")?.alt||t.title||"Unknown Product",id:t.href.split("pid=")[1]?.split("&")[0]||"unknown"})}),n.length===0&&document.querySelectorAll('a[href*="/p/"]').forEach(s=>{n.find(i=>i.url===s.href)||n.push({url:s.href,title:s.innerText||"Unknown Product",id:s.href.split("pid=")[1]?.split("&")[0]||"unknown"})}),n}function c(){const e=document.querySelectorAll("a, span");for(let n of e)if(n.innerText?.includes("Next"))return n;return null}
